<!DOCTYPE html>
<html>
<head>
    <title>RiseApp Admin</title>
</head>
<body>
    <h1>Welcome, Admin!</h1>
    <p>Authentication successful. Please choose a function:</p>
    
    <button id="listUsers">List All Users</button>
    <button id="addUser">Add a New User</button>
    <button id="deleteUser">Delete a User</button>
    
    <script>
        // Function to handle listing all users
        function listUsers(authToken) {
            // Replace this with the actual URL for your API endpoint
            const apiUrl = 'https://zkel9v1575.execute-api.ap-southeast-1.amazonaws.com/prod/admin';
            
            // Set up the API request parameters
            const params = new URLSearchParams({
                action: 'list_users',
                code: authToken,
            });
            
            // Make the API request
            fetch(apiUrl + '?' + params.toString())
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                // Replace this with the actual handling of the user list
                console.log('User list:', data);
                alert('User list: ' + JSON.stringify(data));
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
                alert('Error: ' + error.message);
            });
        }
        
    function captureAndStoreTokens() {
    const hashParams = new URLSearchParams(window.location.hash.slice(1));
    const idToken = hashParams.get('id_token');
    const accessToken = hashParams.get('access_token');
    const tokenExpiry = hashParams.get('expires_in');
    const tokenType = hashParams.get('token_type');

    // Check if the tokens are present
    //if (idToken && accessToken && tokenExpiry && tokenType) {
    if (idToken) {

        // Store the tokens in local storage or perform other actions
        localStorage.setItem('id_token', idToken);
        localStorage.setItem('access_token', accessToken);
        localStorage.setItem('expires_in', tokenExpiry);
        localStorage.setItem('token_type', tokenType);

        // Output the tokens for testing (remove this in production)
        console.log('id_token:', idToken);
        console.log('access_token:', accessToken);
        console.log('expires_in:', tokenExpiry);
        console.log('token_type:', tokenType);
    } else {
        // Tokens are missing
        console.error('Tokens are missing from the URL fragment.');
        alert('Tokens are missing. Authentication failed.');
    }
}


        
        // Function to handle adding a new user
        function addUser() {
            // Replace this with the actual implementation to add a new user
            alert("Adding a new user. Replace this with the actual implementation.");
        }
        
        // Function to handle deleting a user
        function deleteUser() {
            // Replace this with the actual implementation to delete a user
            alert("Deleting a user. Replace this with the actual implementation.");
        }
        
        // Attach click event handlers to the buttons
        document.getElementById('addUser').addEventListener('click', addUser);
        document.getElementById('deleteUser').addEventListener('click', deleteUser);
        // Call the function to capture and store the tokens
captureAndStoreTokens();

    </script>
</body>
</html>
